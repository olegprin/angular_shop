
Blog = angular.module('Blog', ['ngRoute'])
Blog.config(["$routeProvider", "$httpProvider", ($routeProvider, $httpProvider) ->
  $httpProvider.defaults.headers.common['X-CSRF-Token'] = $('meta[name=csrf-token]').attr('content')
  $routeProvider
    .when('/product/new', { templateUrl: '<%=asset_path("postNew.html")%>', controller: 'CreatePostCtrl' } )
    .when('/post/:postId', { templateUrl: '<%=asset_path("postIndex.html")%>', controller: 'PostCtrl' } )
    .otherwise({ templateUrl: '<%=asset_path("mainIndex.html")%>', controller: 'IndexCtrl' } )
])

Blog.controller('IndexCtrl', [
  '$scope','$location','$http', 'postData'
  ($scope, $location, $http, postData) ->
  
    $scope.vasa="olya" 
    $scope.data=postData.data
    postData.loadPost()
    
    $scope.viewPost = (postId)->
      $location.url('/post/'+postId)
    
    $scope.newPost = ->
      $location.url('/product/new')



]);



Blog.controller('CreatePostCtrl', [
  '$scope','$location','$http', '$routeParams','postData'
  ($scope, $location, $http, $routeParams, postData) ->

    $scope.formProduct=
      newProductTitle: "name"
      newProductContents: "name product"
    $scope.girl="olya"

    $scope.createPost=->
      postData.createPost($scope.formProduct)

    $scope.clearPost=->
      $scope.formProduct.newProductTitle=" "
      $scope.formProduct.newProductContents=" "    

]);



Blog.controller('PostCtrl', [
  '$scope','$location','$http', '$routeParams','postData'
  ($scope, $location, $http, $routeParams, postData) ->

      
    $scope.data=
      postData: postData.data
      currentProduct: 
        title: ' '
        description: ' '
        id: ''

    postData.loadPost()
    
    $scope.data.postId=$routeParams.postId
    $scope.girl="olya"

  
    $scope.findArticle=->
      post=_.findWhere(postData.data.products, {id: parseInt($scope.data.postId)})
      $scope.data.currentProduct.title=post.id    
      $scope.data.currentProduct.title=post.title
      $scope.data.currentProduct.description=post.description
    
    $scope.createPost=->
      postData.createPost($scope.formProduct)



    $scope.deletePost=->
      postData.deletePost   
]);







