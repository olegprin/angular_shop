
Blog = angular.module('Blog', ['ngRoute'])
.controller('OlesaCtrl',[
  '$scope'
  ($scope) ->
    $scope.counter = 0
    $scope.add = ($paramater) ->
      $scope.counter += 1
    $scope.minus = ($parameter) ->
      $scope.counter -= 1
    $scope.name={
      name: "Olesa"
    }  
]) 


.controller 'MyController', [
  '$scope','$interpolate'
  ($scope, $interpolate) ->
    $scope.to="enail@.ru"
    $scope.emailBody="fff {{to}} vasa"
    $scope.$watch 'to', (body) ->
      if (body)
      
        parseFun = $interpolate(body)

        $scope.previewText = 
          parseFun { }
     
]








Blog.config(["$routeProvider", ($routeProvider) ->

  $routeProvider
    .when('/post/new', { templateUrl: '<%=asset_path("postNew.html")%>', controller: 'CreatePostCtrl' } )
    .when('/post/:postId', { templateUrl: '<%=asset_path("postIndex.html")%>', controller: 'PostCtrl' } )
    .otherwise({ templateUrl: '<%=asset_path("mainIndex.html")%>', controller: 'IndexCtrl' } )
])

Blog.controller('IndexCtrl', [
  '$scope','$location','$http', 'postData'
  ($scope, $location, $http, postData) ->

	  $scope.data = 
      posts: [{title: 'Loading posts...', contents: ''}]
    
    $scope.data = postData.data
    postData.loadDatas()
    

    $scope.viewPost=(postId) ->
      $location.url('/post/'+postId)    
    
    $scope.navNewPost = ->
      $location.url('/post/new')


]);


Blog.controller('PostCtrl', [
  '$scope','$routeParams', 'postData'
  ($scope,$routeParams, postData) ->
    
    $scope.data = 
      postData: postData.data
    postData.loadDatas()      
    $scope.data.postId=$routeParams.postId
   
])

Blog.controller('CreatePostCtrl', [
  '$scope','$location', 'postData'
  ($scope,$location, postData) ->
    
    $scope.data = postData.data
    postData.loadDatas()
    
    $scope.formData =
      newPostTitle: '10'
      newPostContents: ''

    $scope.navNewPost = ->
      $location.url('/post/new')
   
      
      $http.post('./data.json', data).success( (data) ->
        # Add new post to array of posts
        postData.data.posts.push(data)
        console.log('Successfully created post.')
      ).error( ->
        console.error('Failed to create new post.')
      )

    
    $scope.createPost=(newPost)->
      if newPost.newPostTitle =='' or newPost.newPostContents==''
        alert "Can'b be blank"
        return false
    
      data=
        new_post: 
          title: newPost.newPostTitle
          description: newPost.newPostContents
      
    $scope.navHome = ->
      $location.url('/')


    return true  
])
