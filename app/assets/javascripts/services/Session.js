angular.module('Blogfd', []).factory 'Session', ($location, $http, $q) ->
  service = 
    login: (email, password) ->
      $http.post('/api/sessions', user:
        email: email
        password: password).then (response) ->
        service.currentUser = response.data.user
        if service.isAuthenticated()
          #$location.path(response.data.redirect);
          $location.path '/record'
        return
    logout: (redirectTo) ->
      $http.delete('/api/sessions').then (response) ->
        $http.defaults.headers.common['X-CSRF-Token'] = response.data.csrfToken
        service.currentUser = null
        redirect redirectTo
        return
      return
    register: (email, password, confirm_password) ->
      $http.post('/api/users', user:
        email: email
        password: password
        password_confirmation: confirm_password).then (response) ->
        service.currentUser = response.data
        if service.isAuthenticated()
          $location.path '/record'
        return
    requestCurrentUser: ->
      if service.isAuthenticated()
        $q.when service.currentUser
      else
        $http.get('/api/users').then (response) ->
          service.currentUser = response.data.user
          service.currentUser
    currentUser: null
    isAuthenticated: ->
      ! !service.currentUser
  # Redirect to the given url (defaults to '/')

  redirect = (url) ->
    url = url or '/'
    $location.path url
    return

  service

# ---
# generated by js2coffee 2.2.0